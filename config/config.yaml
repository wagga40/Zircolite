# =============================================================================
# Zircolite Field Mappings Configuration (canonical: config/config.yaml)
# =============================================================================
# This file defines how log fields are processed, mapped, and transformed.
# Supports both JSON (.json) and YAML (.yaml, .yml) formats.
#
# Sections:
#   - enabled_transforms: Quick enable/disable transforms by name (see below)
#   - event_filter: Configure channel/eventID field extraction for filtering
#   - timestamp_detection: Configure timestamp field auto-detection
#   - exclusions: Fields to exclude from processing
#   - useless: Values to filter out (null, empty strings)
#   - mappings: Rename nested/complex field names to simpler ones
#   - alias: Create additional field names with same values
#   - split: Split field values into multiple fields
#   - transforms: Apply Python code to transform field values
# =============================================================================

# -----------------------------------------------------------------------------
# EVENT FILTER CONFIGURATION
# -----------------------------------------------------------------------------
# Configures how Channel and EventID fields are extracted from events for
# early filtering. This allows events that won't match any rules to be
# skipped before expensive processing.
#
# This applies to ALL input types (EVTX, JSON, XML, CSV, etc.) when they
# contain Windows-style log data.
#
# Field paths support:
#   - Dot notation for nested fields (e.g., "Event.System.Channel")
#   - Direct field names (e.g., "Channel")
#   - Paths are tried in order until a value is found
# -----------------------------------------------------------------------------
event_filter:
  # Enable/disable event filtering globally
  enabled: true
  
  # Field paths for Channel extraction (tried in order)
  channel_fields:
    - Event.System.Channel      # Standard EVTX structure
    - Channel                   # Pre-flattened or direct field
    - System.Channel            # JSON with System at top level
    - channel                   # Lowercase variant
    - log_name                  # Common in SIEM exports
    - LogName                   # Windows Event Forwarding
    - source.name               # ECS format
    - winlog.channel            # Elastic Winlogbeat
  
  # Field paths for EventID extraction (tried in order)
  eventid_fields:
    - Event.System.EventID      # Standard EVTX (can be int or dict)
    - Event.System.EventID.#text  # EVTX with dict structure
    - EventID                   # Pre-flattened or direct field
    - System.EventID            # JSON with System at top level
    - System.EventID.#text      # JSON with dict structure
    - eventid                   # Lowercase variant
    - event_id                  # Snake_case variant
    - EventCode                 # Some SIEM exports
    - event.code                # ECS format
    - winlog.event_id           # Elastic Winlogbeat
  
  # Apply filtering to all sources, not just Windows-like logs
  # Set to true if your non-Windows logs also use channel/eventID filtering
  filter_all_sources: false

# -----------------------------------------------------------------------------
# TIMESTAMP DETECTION CONFIGURATION
# -----------------------------------------------------------------------------
# Configures timestamp field detection for time filtering.
# If the default timestamp field is not found, Zircolite can auto-detect
# common timestamp fields from the event data.
# -----------------------------------------------------------------------------
timestamp_detection:
  # Default timestamp field name (used if present)
  default_field: SystemTime
  
  # Enable auto-detection if default field not found
  auto_detect: true
  
  # Timestamp field names to try during auto-detection (in order of priority)
  detection_fields:
    - SystemTime                # Windows EVTX default
    - UtcTime                   # Sysmon logs
    - TimeCreated               # Some Windows exports
    - "@timestamp"              # Elasticsearch/ECS format
    - timestamp                 # Common generic name
    - Timestamp                 # Common generic name (capitalized)
    - time                      # Simple name
    - Time                      # Simple name (capitalized)
    - EventTime                 # Some SIEM exports
    - event_time                # Snake_case variant
    - datetime                  # Common name
    - DateTime                  # Common name (capitalized)
    - date                      # Simple date field
    - Date                      # Simple date field (capitalized)
    - CreatedTime               # Creation timestamp
    - created_time              # Snake_case variant
    - log_time                  # Log timestamp
    - LogTime                   # Log timestamp (capitalized)
    - _time                     # Splunk format
    - event.created             # ECS format
    - "@time"                   # Alternative ECS format
    - ts                        # Short timestamp name
    - recorded_time             # Recording timestamp
    - RecordedTime              # Recording timestamp (capitalized)

# -----------------------------------------------------------------------------
# LOG SOURCE DETECTION CONFIGURATION
# -----------------------------------------------------------------------------
# Configures automatic detection of log sources by examining file content.
# When no explicit format flag is given (-j, -x, -S, -AU, etc.), Zircolite
# will analyze input files to determine the log format and source.
#
# Each source has:
#   - input_type: Processing format for Zircolite
#   - signature_fields: Fields whose presence indicates this source
#   - signature_values: Specific field values that identify this source
#   - timestamp_field: Default timestamp field for this source
#   - suggested_pipeline: Recommended Sigma pipeline
# -----------------------------------------------------------------------------
log_source_detection:
  # Enable/disable automatic detection
  enabled: true

  # Known log source signatures (checked in order)
  sources:
    - name: sysmon_windows
      input_type: json
      signature_fields:
        - Event.System.Channel
        - Event.System.EventID
      signature_values:
        Event.System.Channel:
          - "Microsoft-Windows-Sysmon/Operational"
          - "Microsoft-Windows-Sysmon"
      timestamp_field: UtcTime
      suggested_pipelines: [sysmon, windows-logsources]

    - name: windows_evtx_json
      input_type: json
      signature_fields:
        - Event.System.Channel
        - Event.System.EventID
        - Event.System.Provider
      timestamp_field: SystemTime
      suggested_pipelines: [windows-audit, windows-logsources]

    - name: windows_evtx_json_flat
      input_type: json
      signature_fields:
        - Channel
        - EventID
      timestamp_field: SystemTime
      suggested_pipelines: [windows-audit, windows-logsources]

    - name: ecs_elastic
      input_type: json
      signature_fields:
        - "@timestamp"
      timestamp_field: "@timestamp"

    - name: auditd
      input_type: auditd
      timestamp_field: timestamp

    - name: sysmon_linux
      input_type: sysmon_linux
      timestamp_field: UtcTime
      suggested_pipelines: []

    - name: windows_evtx_xml
      input_type: xml
      timestamp_field: SystemTime
      suggested_pipelines: [windows-audit, windows-logsources]

    - name: evtxtract
      input_type: evtxtract
      timestamp_field: SystemTime
      suggested_pipelines: [windows-audit, windows-logsources]

# -----------------------------------------------------------------------------
# FIELD EXCLUSIONS
# -----------------------------------------------------------------------------
# List of substrings - any field containing these strings will be excluded.
# Useful for removing namespace prefixes or unwanted metadata.
exclusions:
  - xmlns  # XML namespace attributes

# -----------------------------------------------------------------------------
# VALUE EXCLUSIONS (USELESS VALUES)
# -----------------------------------------------------------------------------
# Values that should be filtered out from the final output.
# Fields with these values will be removed from events.
useless:
  - null   # Null values
  - ""     # Empty strings

# -----------------------------------------------------------------------------
# FIELD MAPPINGS
# -----------------------------------------------------------------------------
# Maps long/nested field names to shorter, standardized names.
# Format: "Original.Nested.Field.Name": "SimplifiedName"
#
# These mappings are essential for:
#   - Normalizing EVTX XML structure to flat fields
#   - Making field names compatible with SIGMA rules
#   - Simplifying queries and analysis
# -----------------------------------------------------------------------------
mappings:
  Event.EventData.UserData: UserData
  Event.System.Provider.#attributes.Guid: Guid
  Event.EventData.ContextInfo: ContextInfo
  Event.System.Execution.#attributes.ProcessID: ProcessID
  Event.System.Execution.#attributes.ThreadID: ThreadID
  Event.System.EventID: EventID
  Event.System.EventID.#text: EventID  # Alternative format
  Event.System.Channel: Channel
  Event.System.Computer: Computer
  Event.System.Correlation: Correlation
  Event.System.Correlation.#attributes.ActivityID: ActivityID
  Event.System.EventID.#attributes.Qualifiers: Qualifiers
  Event.System.EventRecordID: EventRecordID
  Event.System.Keywords: Keywords
  Event.System.Level: Level
  Event.System.Opcode: Opcode
  Event.System.Task: Task
  Event.System.Version: Version
  Event.System.Provider.#attributes.EventSourceName: EventSourceName
  Event.System.Provider.#attributes.Name: Provider_Name
  Event.System.Security: Security
  Event.System.Security.#attributes.UserID: UserID
  Event.System.TimeCreated.#attributes.SystemTime: SystemTime
  Event.EventData.AccessList: AccessList
  Event.EventData.AccessMask: AccessMask
  Event.EventData.Accesses: Accesses
  Event.EventData.AccountDomain: AccountDomain
  Event.EventData.AccountExpires: AccountExpires
  Event.EventData.AccountName: AccountName
  Event.EventData.AuthenticationPackageName: AuthenticationPackageName
  Event.EventData.FailureCode: FailureCode
  Event.EventData.FailureReason: FailureReason
  Event.EventData.KeyLength: KeyLength
  Event.EventData.LmPackageName: LmPackageName
  Event.EventData.LogonGuid: LogonGuid
  Event.EventData.LogonHours: LogonHours
  Event.EventData.LogonId: LogonId
  Event.EventData.LogonProcessName: LogonProcessName
  Event.EventData.LogonType: LogonType
  Event.EventData.PrivilegeList: PrivilegeList
  Event.EventData.SecurityPackageName: SecurityPackageName
  Event.EventData.TicketEncryptionType: TicketEncryptionType
  Event.EventData.TicketOptions: TicketOptions
  Event.EventData.TokenElevationType: TokenElevationType
  Event.EventData.TransmittedServices: TransmittedServices
  Event.EventData.CallTrace: CallTrace
  Event.EventData.CommandLine: CommandLine
  Event.EventData.CurrentDirectory: CurrentDirectory
  Event.EventData.Image: Image
  Event.EventData.ImageLoaded: ImageLoaded
  Event.EventData.ImagePath: ImagePath
  Event.EventData.IntegrityLevel: IntegrityLevel
  Event.EventData.NewProcessId: NewProcessId
  Event.EventData.NewProcessName: NewProcessName
  Event.EventData.OriginalFileName: OriginalFileName
  Event.EventData.ParentCommandLine: ParentCommandLine
  Event.EventData.ParentImage: ParentImage
  Event.EventData.ParentProcessGuid: ParentProcessGuid
  Event.EventData.ParentProcessId: ParentProcessId
  Event.EventData.ParentIntegrityLevel: ParentIntegrityLevel
  Event.EventData.ParentUser: ParentUser
  Event.EventData.ProcessCommandLine: ProcessCommandLine
  Event.EventData.ProcessGuid: ProcessGuid
  Event.EventData.ProcessId: ProcessId
  Event.EventData.ProcessName: ProcessName
  Event.EventData.SourceImage: SourceImage
  Event.EventData.SourceProcessGuid: SourceProcessGuid
  Event.EventData.SourceProcessId: SourceProcessId
  Event.EventData.StartAddress: StartAddress
  Event.EventData.StartFunction: StartFunction
  Event.EventData.StartModule: StartModule
  Event.EventData.TargetImage: TargetImage
  Event.EventData.TargetProcessAddress: TargetProcessAddress
  Event.EventData.TargetProcessGuid: TargetProcessGuid
  Event.EventData.TargetProcessId: TargetProcessId
  Event.EventData.TerminalSessionId: TerminalSessionId
  Event.EventData.Address: Address
  Event.EventData.AddressLength: AddressLength
  Event.EventData.Application: Application
  Event.EventData.DestinationAddress: DestinationAddress
  Event.EventData.DestinationHostname: DestinationHostname
  Event.EventData.DestinationIp: DestinationIp
  Event.EventData.DestinationIsIpv6: DestinationIsIpv6
  Event.EventData.DestinationPort: DestinationPort
  Event.EventData.DestinationPortName: DestinationPortName
  Event.EventData.DestPort: DestPort
  Event.EventData.Initiated: Initiated
  Event.EventData.IpAddress: IpAddress
  Event.EventData.IpPort: IpPort
  Event.EventData.LayerRTID: LayerRTID
  Event.EventData.Protocol: Protocol
  Event.EventData.QueryName: QueryName
  Event.EventData.QueryResults: QueryResults
  Event.EventData.QueryStatus: QueryStatus
  Event.EventData.SourceAddress: SourceAddress
  Event.EventData.SourceHostname: SourceHostname
  Event.EventData.SourceIp: SourceIp
  Event.EventData.SourceNetworkAddress: SourceNetworkAddress
  Event.EventData.SourceIsIpv6: SourceIsIpv6
  Event.EventData.SourcePort: SourcePort
  Event.EventData.SourcePortName: SourcePortName
  Event.EventData.CreationUtcTime: CreationUtcTime
  Event.EventData.Detail: Detail
  Event.EventData.Details: Details
  Event.EventData.HandleId: HandleId
  Event.EventData.Hash: Hash
  Event.EventData.Hashes: Hashes
  Event.EventData.HiveName: HiveName
  Event.EventData.NewName: NewName
  Event.EventData.ObjectName: ObjectName
  Event.EventData.ObjectServer: ObjectServer
  Event.EventData.ObjectType: ObjectType
  Event.EventData.ObjectValueName: ObjectValueName
  Event.EventData.RelativeTargetName: RelativeTargetName
  Event.EventData.ShareLocalPath: ShareLocalPath
  Event.EventData.ShareName: ShareName
  Event.EventData.TargetFilename: TargetFileName  # Note: normalized to TargetFileName
  Event.EventData.TargetObject: TargetObject
  Event.EventData.AllowedToDelegateTo: AllowedToDelegateTo
  Event.EventData.DisplayName: DisplayName
  Event.EventData.Group: Group
  Event.EventData.GroupDomain: GroupDomain
  Event.EventData.GroupName: GroupName
  Event.EventData.GroupSid: GroupSid
  Event.EventData.HomeDirectory: HomeDirectory
  Event.EventData.HomePath: HomePath
  Event.EventData.NewUacValue: NewUacValue
  Event.EventData.OldUacValue: OldUacValue
  Event.EventData.PasswordLastSet: PasswordLastSet
  Event.EventData.PrimaryGroupId: PrimaryGroupId
  Event.EventData.ProfilePath: ProfilePath
  Event.EventData.SamAccountName: SAMAccountName
  Event.EventData.ScriptPath: ScriptPath
  Event.EventData.ServicePrincipalNames: ServicePrincipalNames
  Event.EventData.SidHistory: SidHistory
  Event.EventData.SubjectDomainName: SubjectDomainName
  Event.EventData.SubjectLogonId: SubjectLogonId
  Event.EventData.SubjectUserName: SubjectUserName
  Event.EventData.SubjectUserSid: SubjectUserSid
  Event.EventData.TargetDomainName: TargetDomainName
  Event.EventData.TargetInfo: TargetInfo
  Event.EventData.TargetLogonGuid: TargetLogonGuid
  Event.EventData.TargetLogonId: TargetLogonId
  Event.EventData.TargetServerName: TargetServerName
  Event.EventData.TargetSid: TargetSid
  Event.EventData.TargetUserName: TargetUserName
  Event.EventData.TargetUserSid: TargetUserSid
  Event.EventData.User: User
  Event.EventData.UserAccountControl: UserAccountControl
  Event.EventData.UserParameters: UserParameters
  Event.EventData.UserPrincipalName: UserPrincipalName
  Event.EventData.UserSid: UserSid
  Event.EventData.UserWorkstations: UserWorkstations
  Event.EventData.Service: Service
  Event.EventData.ServiceName: ServiceName
  Event.EventData.ServiceType: ServiceType
  Event.EventData.ServiceVersion: ServiceVersion
  Event.EventData.StartTime: StartTime
  Event.EventData.StartType: StartType
  Event.EventData.State: State
  Event.EventData.Status: Status
  Event.EventData.StopTime: StopTime
  Event.EventData.TaskContent: TaskContent
  Event.EventData.TaskContentNew: TaskContentNew
  Event.EventData.TaskName: TaskName
  Event.EventData.HostApplication: HostApplication
  Event.EventData.HostName: HostName
  Event.EventData.HostVersion: HostVersion
  Event.EventData.Payload: Payload
  Event.EventData.ScriptBlockText: ScriptBlockText
  Event.EventData.AttributeLDAPDisplayName: AttributeLDAPDisplayName
  Event.EventData.AttributeValue: AttributeValue
  Event.EventData.DCName: DCName
  Event.EventData.LDAPDisplayName: LDAPDisplayName
  Event.EventData.ObjectClass: ObjectClass
  Event.EventData.OperationType: OperationType
  Event.EventData.Properties: Properties
  Event.EventData.AuditPolicyChanges: AuditPolicyChanges
  Event.EventData.AuditSourceName: AuditSourceName
  Event.EventData.NotificationPackageName: NotificationPackageName
  Event.EventData.DeviceClassName: DeviceClassName
  Event.EventData.DeviceDescription: DeviceDescription
  Event.EventData.DeviceName: DeviceName
  Event.EventData.DeviceNameLength: DeviceNameLength
  Event.EventData.DeviceTime: DeviceTime
  Event.EventData.DeviceVersionMajor: DeviceVersionMajor
  Event.EventData.DeviceVersionMinor: DeviceVersionMinor
  Event.EventData.DetectionSource: DetectionSource
  Event.EventData.EngineVersion: EngineVersion
  Event.EventData.PuaCount: PuaCount
  Event.EventData.PuaPolicyId: PuaPolicyId
  Event.EventData.Signature: Signature
  Event.EventData.SignatureStatus: SignatureStatus
  Event.EventData.Signed: Signed
  Event.EventData.Binary: Binary
  Event.EventData.BootMode: BootMode
  Event.EventData.BuildVersion: BuildVersion
  Event.EventData.Company: Company
  Event.EventData.Context: Context
  Event.EventData.Description: Description
  Event.EventData.ErrorCode: ErrorCode
  Event.EventData.ErrorDescription: ErrorDescription
  Event.EventData.ErrorMessage: ErrorMessage
  Event.EventData.EventSourceId: EventSourceId
  Event.EventData.EventType: EventType
  Event.EventData.ExtraInfo: ExtraInfo
  Event.EventData.FileVersion: FileVersion
  Event.EventData.FilterHostProcessID: FilterHostProcessID
  Event.EventData.FinalStatus: FinalStatus
  Event.EventData.GrantedAccess: GrantedAccess
  Event.EventData.IdleStateCount: IdleStateCount
  Event.EventData.MajorVersion: MajorVersion
  Event.EventData.Data.#text: Message
  Event.EventData.MinorVersion: MinorVersion
  Event.EventData.NewState: NewState
  Event.EventData.NewThreadId: NewThreadId
  Event.EventData.NewTime: NewTime
  Event.EventData.NewValue: NewValue
  Event.EventData.Number: Number
  Event.EventData.NumberOfGroupPolicyObjects: NumberOfGroupPolicyObjects
  Event.EventData.OldTime: OldTime
  Event.EventData.PackageName: PackageName
  Event.EventData.PerfStateCount: PerfStateCount
  Event.EventData.PreviousTime: PreviousTime
  Event.EventData.ProcessingMode: ProcessingMode
  Event.EventData.ProcessingTimeInMilliseconds: ProcessingTimeInMilliseconds
  Event.EventData.Product: Product
  Event.EventData.ProtocolHostProcessID: ProtocolHostProcessID
  Event.EventData.Publisher: Publisher
  Event.EventData.QfeVersion: QfeVersion
  Event.EventData.ResourceManager: ResourceManager
  Event.EventData.RetryMinutes: RetryMinutes
  Event.EventData.RuleName: RuleName
  Event.EventData.SchemaVersion: SchemaVersion
  Event.EventData.ServerID: ServerID
  Event.EventData.ServerURL: ServerURL
  Event.EventData.ShutdownActionType: ShutdownActionType
  Event.EventData.ShutdownEventCode: ShutdownEventCode
  Event.EventData.ShutdownReason: ShutdownReason
  Event.EventData.SubStatus: SubStatus
  Event.EventData.ThrottleStateCount: ThrottleStateCount
  Event.EventData.TimeSource: TimeSource
  Event.EventData.TransactionId: TransactionId
  Event.EventData.TSId: TSId
  Event.EventData.UtcTime: UtcTime
  Event.EventData.Version: Version
  Event.EventData.Workstation: Workstation
  Event.EventData.WorkstationName: WorkstationName
  Event.EventData.AddonName: AddonName
  Event.EventData.ExtensionId: ExtensionId
  Event.EventData.ExtensionName: ExtensionName
  Event.EventData.CallingProcessName: CallingProcessName
  Event.EventData.PipeName: PipeName
  Event.EventData.updateGuid: updateGuid
  Event.EventData.updateRevisionNumber: updateRevisionNumber
  Event.EventData.updateTitle: updateTitle

# --- ECS / WINLOGBEAT / ELASTIC AGENT MAPPINGS ---
# ECS Mapping from https://github.com/Maspital
# DNS & Network
  dns.question.name: QueryName
  dns.question.registered_domain: QueryName
  dns.answers.data: QueryResults
  dns.resolved_ip: DestinationIp
  network.protocol: Protocol

  # File & Code Signing
  file.code_signature.subject_name: Signature
  file.code_signature.status: SignatureStatus
  file.code_signature.valid: Signed
  file.pe.imphash: Imphash
  file.pe.original_file_name: OriginalFileName
  file.path: TargetFilename
  file.name: TargetFileName
  file.directory: TargetFilename  # Fallback
  
  # Process (ECS)
  process.command_line: CommandLine
  process.executable: Image
  process.name: ProcessName
  process.pid: ProcessId
  process.entity_id: ProcessGuid
  process.working_directory: CurrentDirectory
  process.args: ProcessArgs
  
  # Parent Process (ECS)
  process.parent.command_line: ParentCommandLine
  process.parent.executable: ParentImage
  process.parent.name: ParentProcessName
  process.parent.pid: ParentProcessId
  process.parent.entity_id: ParentProcessGuid

  # Hashes (ECS & Winlogbeat)
  process.hash.md5: MD5
  process.hash.sha1: SHA1
  process.hash.sha256: SHA256
  process.hash.imphash: Imphash
  hash.md5: MD5
  hash.sha1: SHA1
  hash.sha256: SHA256
  hash.imphash: Imphash

  # User & Host (ECS)
  user.name: User
  user.domain: UserDomain
  user.id: UserSid
  host.name: Computer
  host.hostname: ComputerName

  # Event Meta
  event.code: EventID
  event.action: EventType
  event.provider: Provider_Name
  event.created: EventTime

  # Winlog Meta
  winlog.channel: Channel
  winlog.event_id: EventID
  winlog.computer_name: Computer
  winlog.provider_name: Provider_Name
  winlog.provider_guid: Guid
  winlog.record_id: EventRecordID
  winlog.task: Task
  winlog.opcode: Opcode

  # Winlog Event Data
  winlog.event_data.CommandLine: CommandLine
  winlog.event_data.Image: Image
  winlog.event_data.ParentCommandLine: ParentCommandLine
  winlog.event_data.ParentImage: ParentImage
  winlog.event_data.OriginalFileName: OriginalFileName
  winlog.event_data.IntegrityLevel: IntegrityLevel
  winlog.event_data.LogonId: LogonId
  winlog.event_data.LogonGuid: LogonGuid
  winlog.event_data.TerminalSessionId: TerminalSessionId
  winlog.event_data.User: User
  winlog.event_data.CurrentDirectory: CurrentDirectory
  winlog.event_data.Hashes: Hashes
  winlog.event_data.ProcessGuid: ProcessGuid
  winlog.event_data.ProcessId: ProcessId
  winlog.event_data.ParentProcessGuid: ParentProcessGuid
  winlog.event_data.ParentProcessId: ParentProcessId
  winlog.event_data.ParentUser: ParentUser
  winlog.event_data.Company: Company
  winlog.event_data.Description: Description
  winlog.event_data.FileVersion: FileVersion
  winlog.event_data.Product: Product
  winlog.event_data.RuleName: RuleName
  winlog.event_data.UtcTime: UtcTime
  winlog.event_data.TargetFilename: TargetFileName
  winlog.event_data.TargetObject: TargetObject
  winlog.event_data.Details: Details
  winlog.event_data.SourceImage: SourceImage
  winlog.event_data.TargetImage: TargetImage
  winlog.event_data.DestinationIp: DestinationIp
  winlog.event_data.DestinationPort: DestinationPort
  winlog.event_data.DestinationHostname: DestinationHostname
  winlog.event_data.SourceIp: SourceIp
  winlog.event_data.SourcePort: SourcePort
  winlog.event_data.QueryName: QueryName
  winlog.event_data.QueryResults: QueryResults

  winlog.event_data.CallTrace: CallTrace
  winlog.event_data.GrantedAccess: GrantedAccess
  winlog.event_data.TargetName: TargetName
  winlog.event_data.TargetUserName: TargetUserName
  winlog.event_data.TargetDomainName: TargetDomainName
  winlog.event_data.SubjectUserName: SubjectUserName
  winlog.event_data.SubjectDomainName: SubjectDomainName
  winlog.event_data.SubjectUserSid: SubjectUserSid
  winlog.event_data.TargetUserSid: TargetUserSid
  winlog.event_data.NewName: NewName
  winlog.event_data.CallerProcessId: CallerProcessId
  winlog.event_data.CallerProcessName: CallerProcessName
  winlog.event_data.WorkstationName: WorkstationName
  winlog.event_data.IpAddress: IpAddress
  winlog.event_data.IpPort: IpPort

# -----------------------------------------------------------------------------
# FIELD ALIASES
# -----------------------------------------------------------------------------
# Create additional field names that contain the same value as the original.
# Useful for compatibility with different SIGMA rule naming conventions.
# Format: "OriginalField": "AliasField"
#
# Example:
#   CommandLine: cmd
#   Image: ProcessPath
# -----------------------------------------------------------------------------
alias: {}

# -----------------------------------------------------------------------------
# FIELD SPLITTING
# -----------------------------------------------------------------------------
# Split a single field value into multiple fields based on separators.
# Commonly used for hash fields that contain multiple hash types.
#
# Format:
#   FieldName:
#     separator: ","     # Character(s) separating key-value pairs
#     equal: "="         # Character(s) separating key from value
#
# Example: "MD5=abc123,SHA256=def456" becomes:
#   MD5: abc123
#   SHA256: def456
# -----------------------------------------------------------------------------
split:
  Hash:
    separator: ","
    equal: "="
  Hashes:
    separator: ","
    equal: "="
  ConfigurationFileHash:
    separator: ","
    equal: "="

# -----------------------------------------------------------------------------
# TRANSFORMS
# -----------------------------------------------------------------------------
# Enable/disable the transform engine globally.
# When disabled, all transform definitions are ignored.
# -----------------------------------------------------------------------------

# =============================================================================
# TRANSFORM ENABLE/DISABLE CONTROL
# =============================================================================
# Quick way to enable/disable transforms without editing each transform.
# Uncomment transforms you want to enable. Transforms not listed here or
# commented out are DISABLED.
#
# Note: transforms_enabled must be true for any transforms to run.
# =============================================================================
transforms_enabled: true

enabled_transforms:
  # -------------------------
  # AUDITD (Linux)
  # -------------------------
  - proctitle                        # Decode hex proctitle to ASCII
  - cmd                              # Decode hex cmd to ASCII

  # -------------------------
  # BASE64 DECODING
  # -------------------------
  #- CommandLine_b64decoded         # Decode Base64 in command lines
  #- ScriptBlockText_b64decoded     # Decode Base64 in PowerShell scripts
  #- Payload_b64decoded             # Decode Base64 in payload fields
  #- ServiceFileName_b64decoded     # Decode Base64 in service file names

  # -------------------------
  # CREDENTIALS
  # -------------------------
  #- CommandLine_Extracted_Creds    # Extract creds from net/wmic/psexec

  # -------------------------
  # COMMAND LINE ANALYSIS
  # -------------------------
  #- CommandLine_URLs               # Extract URLs from command lines
  #- CommandLine_RegistryPaths      # Extract registry key paths
  #- CommandLine_Length              # Categorize command line length (SHORT/MEDIUM/LONG/VERY_LONG)
  #- CommandLine_EntropyScore       # Shannon entropy for obfuscation detection
  #- CommandLine_XORIndicators      # Detect XOR in command lines
  #- CommandLine_AMSIBypass         # Detect AMSI bypass attempts
  #- CommandLine_HexStrings         # Find hex-encoded strings
  #- CommandLine_EnvVarObfuscation  # Detect env variable abuse
  #- CommandLine_DownloadCradle     # Detect download cradles
  #- CommandLine_EvasionTechniques  # Detect evasion techniques
  #- CommandLine_LateralMovement    # Identify lateral movement tool usage
  #- CommandLine_DataStaging        # Detect data staging for exfiltration
  #- CommandLine_C2Indicators       # C2 framework fingerprinting
  #- CommandLine_PersistenceCategory # Categorize persistence mechanisms
  #- CommandLine_ReconIndicators    # Detect reconnaissance commands
  #- CommandLine_ConcatDeobfuscate  # Deobfuscate string concatenation/escaping
  #- CommandLine_CryptoMining       # Detect cryptocurrency mining indicators
  #- CommandLine_InjectionTechnique # Classify process injection techniques

  # -------------------------
  # PROCESS ANALYSIS
  # -------------------------
  #- Image_ExeName                  # Extract exe name from path
  #- Image_LOLBinMatch              # Detect LOLBins (certutil, mshta, etc.)
  #- Image_TyposquatDetect          # Detect typosquatted process names
  #- Image_PathAnomaly              # Flag suspicious execution paths
  #- Image_StagingDirectory         # Detect attacker staging directories
  #- Image_MasqueradeDetect         # Detect process name masquerading
  #- ParentImage_ExeName            # Extract parent exe name
  #- ParentImage_SpawnAnomaly       # Flag anomalous parent-child relationships

  # -------------------------
  # POWERSHELL ANALYSIS
  # -------------------------
  #- ScriptBlockText_ObfuscationIndicators  # Detect obfuscation patterns
  #- ScriptBlockText_XORPatterns    # Detect XOR operations
  #- ScriptBlockText_ReflectionAbuse # Detect .NET reflection abuse
  #- ScriptBlockText_ShellcodeIndicators   # Detect shellcode patterns
  #- ScriptBlockText_NetworkIOCs    # Extract IPs/URLs from scripts
  #- ScriptBlockText_StagerDetect   # Detect PowerShell stagers/downloaders
  #- ScriptBlockText_PackerIndicators # Detect packer/crypter patterns

  # -------------------------
  # NETWORK ANALYSIS
  # -------------------------
  #- QueryName_TLD                  # Extract TLD from DNS queries
  #- QueryName_EntropyScore         # Entropy for DGA detection
  #- QueryName_TyposquatDetect      # Detect typosquatted domains
  #- QueryName_SubdomainAnalysis    # DNS subdomain structure analysis
  #- DestinationIp_ObfuscationCheck # Detect obfuscated IPs
  #- DestinationPort_Category       # Categorize ports

  # -------------------------
  # FILE ANALYSIS
  # -------------------------
  #- TargetFileName_URLDecoded      # URL decode file paths
  #- TargetFileName_DoubleExtension # Detect double extension tricks (e.g. .pdf.exe)
  #- TargetFileName_SensitiveFile   # Flag access to sensitive files (SAM, NTDS, etc.)

  # -------------------------
  # USER & AUTHENTICATION
  # -------------------------
  #- User_Name                      # Extract username without domain
  #- User_Domain                    # Extract domain from user field
  #- LogonType_Description          # Map logon type IDs to human-readable labels

  # -------------------------
  # HASH EXTRACTION
  # -------------------------
  #- Hash_MD5                       # Extract MD5 from Hashes field
  #- Hash_SHA256                    # Extract SHA256 from Hashes field

  # -------------------------
  # REGISTRY ANALYSIS
  # -------------------------
  #- TargetObject_SuspiciousRegistry # Detect persistence registry keys

# -----------------------------------------------------------------------------
# TRANSFORM CATEGORIES
# -----------------------------------------------------------------------------
# Categories group transforms for use with the --transform-category CLI option.
# Example: --transform-category commandline --transform-category network
transform_categories:
  auditd:
    - proctitle
    - cmd
  base64:
    - CommandLine_b64decoded
    - ScriptBlockText_b64decoded
    - Payload_b64decoded
    - ServiceFileName_b64decoded
  credentials:
    - CommandLine_Extracted_Creds
  commandline:
    - CommandLine_URLs
    - CommandLine_RegistryPaths
    - CommandLine_Length
    - CommandLine_EntropyScore
    - CommandLine_XORIndicators
    - CommandLine_AMSIBypass
    - CommandLine_HexStrings
    - CommandLine_EnvVarObfuscation
    - CommandLine_DownloadCradle
    - CommandLine_EvasionTechniques
    - CommandLine_LateralMovement
    - CommandLine_DataStaging
    - CommandLine_C2Indicators
    - CommandLine_PersistenceCategory
    - CommandLine_ReconIndicators
    - CommandLine_ConcatDeobfuscate
    - CommandLine_CryptoMining
    - CommandLine_InjectionTechnique
  process:
    - Image_ExeName
    - Image_LOLBinMatch
    - Image_TyposquatDetect
    - Image_PathAnomaly
    - Image_StagingDirectory
    - Image_MasqueradeDetect
    - ParentImage_ExeName
    - ParentImage_SpawnAnomaly
  powershell:
    - ScriptBlockText_ObfuscationIndicators
    - ScriptBlockText_XORPatterns
    - ScriptBlockText_ReflectionAbuse
    - ScriptBlockText_ShellcodeIndicators
    - ScriptBlockText_NetworkIOCs
    - ScriptBlockText_StagerDetect
    - ScriptBlockText_PackerIndicators
  network:
    - QueryName_TLD
    - QueryName_EntropyScore
    - QueryName_TyposquatDetect
    - QueryName_SubdomainAnalysis
    - DestinationIp_ObfuscationCheck
    - DestinationPort_Category
  file:
    - TargetFileName_URLDecoded
    - TargetFileName_DoubleExtension
    - TargetFileName_SensitiveFile
  user:
    - User_Name
    - User_Domain
    - LogonType_Description
  hash:
    - Hash_MD5
    - Hash_SHA256
  registry:
    - TargetObject_SuspiciousRegistry


# -----------------------------------------------------------------------------
# TRANSFORMS DIRECTORY
# -----------------------------------------------------------------------------
# Directory containing external transform files (type: python_file).
# Path is relative to this config file's directory.
# Default: transforms/
# -----------------------------------------------------------------------------
transforms_dir: transforms/

# -----------------------------------------------------------------------------
# TRANSFORM DEFINITIONS
# -----------------------------------------------------------------------------
# Transforms can be defined inline or in external files:
#
#   Inline (type: python):
#     - info: "Description"
#       type: python
#       code: |
#         def transform(param):
#             return transformed_value
#       alias: true
#       alias_name: "OutputField"
#       source_condition: [evtx_input, json_input, ...]
#
#   External file (type: python_file):
#     - info: "Description"
#       type: python_file
#       file: my_transform.py          # relative to transforms_dir
#       alias: true
#       alias_name: "OutputField"
#       source_condition: [evtx_input, json_input, ...]
#
# External files contain a single def transform(param): function.
# Use config/transform_tester.py to develop and test transforms.
# -----------------------------------------------------------------------------
transforms:
  # -------------------------
  # Auditd Transforms
  # -------------------------
  proctitle:
    - info: "Proctitle HEX to ASCII"
      type: python_file
      file: proctitle_proctitle_hex_to_ascii.py
      alias: false
      alias_name: ""
      source_condition:
        - auditd_input

  cmd:
    - info: "Cmd HEX to ASCII"
      type: python_file
      file: cmd_cmd_hex_to_ascii.py
      alias: false
      alias_name: ""
      source_condition:
        - auditd_input

  # -------------------------
  # CommandLine Transforms
  # -------------------------
  CommandLine:
    # INLINE EXAMPLE: This transform is kept inline for reference.
    # All other transforms use external files (type: python_file).
    - info: "Base64 decoded CommandLine"
      type: python
      code: |
        def transform(param):
            # Minimum 20 base64 chars (5 groups of 4) to avoid false positives on normal strings
            base64_pattern = r'(?:[A-Za-z0-9+/]{4}){5,}(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?'
            matches = re.findall(base64_pattern, param)
            if not matches:
                return ''
            decoded_values = []
            for match in matches:
                try:
                    decoded_bytes = base64.b64decode(match)
                    detection = chardet.detect(decoded_bytes)
                    encoding = detection.get('encoding')
                    confidence = detection.get('confidence', 0) or 0
                    if encoding and confidence > 0.5 and encoding.lower() in ('utf-8', 'ascii', 'utf-16le'):
                        decoded_str = decoded_bytes.decode(encoding).strip()
                        if decoded_str.isprintable() and len(decoded_str) > 10:
                            decoded_values.append(decoded_str)
                except:
                    continue
            return '|'.join(decoded_values) if decoded_values else 'b64_detected_cannot_decode'
      alias: true
      alias_name: "CommandLine_b64decoded"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "CommandLine credentials extraction"
      type: python_file
      file: commandline_extracted_creds.py
      alias: true
      alias_name: "CommandLine_Extracted_Creds"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Extract URLs from CommandLine"
      type: python_file
      file: commandline_urls.py
      alias: true
      alias_name: "CommandLine_URLs"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect XOR operations in CommandLine"
      type: python_file
      file: commandline_xorindicators.py
      alias: true
      alias_name: "CommandLine_XORIndicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect AMSI bypass indicators"
      type: python_file
      file: commandline_amsibypass.py
      alias: true
      alias_name: "CommandLine_AMSIBypass"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect and extract hex strings"
      type: python_file
      file: commandline_hexstrings.py
      alias: true
      alias_name: "CommandLine_HexStrings"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect environment variable obfuscation"
      type: python_file
      file: commandline_envvarobfuscation.py
      alias: true
      alias_name: "CommandLine_EnvVarObfuscation"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect download cradles and remote execution"
      type: python_file
      file: commandline_downloadcradle.py
      alias: true
      alias_name: "CommandLine_DownloadCradle"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect common evasion techniques"
      type: python_file
      file: commandline_evasiontechniques.py
      alias: true
      alias_name: "CommandLine_EvasionTechniques"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Extract registry paths from CommandLine"
      type: python_file
      file: commandline_registrypaths.py
      alias: true
      alias_name: "CommandLine_RegistryPaths"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Categorize command line length"
      type: python_file
      file: commandline_length.py
      alias: true
      alias_name: "CommandLine_Length"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Calculate command line Shannon entropy"
      type: python_file
      file: commandline_entropyscore.py
      alias: true
      alias_name: "CommandLine_EntropyScore"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect lateral movement tool usage"
      type: python_file
      file: commandline_lateralmovement.py
      alias: true
      alias_name: "CommandLine_LateralMovement"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect data staging and collection"
      type: python_file
      file: commandline_datastaging.py
      alias: true
      alias_name: "CommandLine_DataStaging"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Identify C2 framework indicators"
      type: python_file
      file: commandline_c2indicators.py
      alias: true
      alias_name: "CommandLine_C2Indicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Categorize persistence mechanisms"
      type: python_file
      file: commandline_persistencecategory.py
      alias: true
      alias_name: "CommandLine_PersistenceCategory"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect reconnaissance commands"
      type: python_file
      file: commandline_reconindicators.py
      alias: true
      alias_name: "CommandLine_ReconIndicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Deobfuscate string concatenation patterns"
      type: python_file
      file: commandline_concatdeobfuscate.py
      alias: true
      alias_name: "CommandLine_ConcatDeobfuscate"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect cryptocurrency mining indicators"
      type: python_file
      file: commandline_cryptomining.py
      alias: true
      alias_name: "CommandLine_CryptoMining"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Classify code injection techniques"
      type: python_file
      file: commandline_injectiontechnique.py
      alias: true
      alias_name: "CommandLine_InjectionTechnique"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Payload Transforms
  # -------------------------
  Payload:
    - info: "Base64 decoded Payload"
      type: python_file
      file: payload_b64decoded.py
      alias: true
      alias_name: "Payload_b64decoded"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # ServiceFileName Transforms
  # -------------------------
  ServiceFileName:
    - info: "Base64 decoded ServiceFileName"
      type: python_file
      file: servicefilename_b64decoded.py
      alias: true
      alias_name: "ServiceFileName_b64decoded"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # File Name Transforms
  # -------------------------
  TargetFileName:
    - info: "URL decode TargetFileName"
      type: python_file
      file: targetfilename_urldecoded.py
      alias: true
      alias_name: "TargetFileName_URLDecoded"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect double extension file tricks"
      type: python_file
      file: targetfilename_doubleextension.py
      alias: true
      alias_name: "TargetFileName_DoubleExtension"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Flag access to security-sensitive files"
      type: python_file
      file: targetfilename_sensitivefile.py
      alias: true
      alias_name: "TargetFileName_SensitiveFile"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Network Transforms
  # -------------------------
  DestinationIp:
    - info: "Detect obfuscated IP address formats"
      type: python_file
      file: destinationip_obfuscationcheck.py
      alias: true
      alias_name: "DestinationIp_ObfuscationCheck"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Process Image Transforms
  # -------------------------
  Image:
    - info: "Extract executable name from Image path"
      type: python_file
      file: image_exename.py
      alias: true
      alias_name: "Image_ExeName"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect LOLBins in Image path"
      type: python_file
      file: image_lolbinmatch.py
      alias: true
      alias_name: "Image_LOLBinMatch"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect typosquatted process names"
      type: python_file
      file: image_typosquatdetect.py
      alias: true
      alias_name: "Image_TyposquatDetect"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Flag suspicious process execution paths"
      type: python_file
      file: image_pathanomaly.py
      alias: true
      alias_name: "Image_PathAnomaly"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect execution from staging directories"
      type: python_file
      file: image_stagingdirectory.py
      alias: true
      alias_name: "Image_StagingDirectory"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - auditd_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Detect process name masquerading"
      type: python_file
      file: image_masqueradedetect.py
      alias: true
      alias_name: "Image_MasqueradeDetect"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Parent Process Transforms
  # -------------------------
  ParentImage:
    - info: "Extract parent executable name"
      type: python_file
      file: parentimage_exename.py
      alias: true
      alias_name: "ParentImage_ExeName"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

    - info: "Flag anomalous parent process context"
      type: python_file
      file: parentimage_spawnanomaly.py
      alias: true
      alias_name: "ParentImage_SpawnAnomaly"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - sysmon_linux_input
        - evtxtract_input
        - db_input

  # -------------------------
  # PowerShell ScriptBlock Transforms
  # -------------------------
  ScriptBlockText:
    - info: "Base64 decoded ScriptBlockText"
      type: python_file
      file: scriptblocktext_b64decoded.py
      alias: true
      alias_name: "ScriptBlockText_b64decoded"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect obfuscated PowerShell indicators"
      type: python_file
      file: scriptblocktext_obfuscationindicators.py
      alias: true
      alias_name: "ScriptBlockText_ObfuscationIndicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect XOR key patterns in ScriptBlockText"
      type: python_file
      file: scriptblocktext_xorpatterns.py
      alias: true
      alias_name: "ScriptBlockText_XORPatterns"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect .NET reflection abuse"
      type: python_file
      file: scriptblocktext_reflectionabuse.py
      alias: true
      alias_name: "ScriptBlockText_ReflectionAbuse"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect shellcode indicators"
      type: python_file
      file: scriptblocktext_shellcodeindicators.py
      alias: true
      alias_name: "ScriptBlockText_ShellcodeIndicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Extract network IOCs from ScriptBlockText"
      type: python_file
      file: scriptblocktext_networkiocs.py
      alias: true
      alias_name: "ScriptBlockText_NetworkIOCs"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect PowerShell stager patterns"
      type: python_file
      file: scriptblocktext_stagerdetect.py
      alias: true
      alias_name: "ScriptBlockText_StagerDetect"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect packer and crypter patterns"
      type: python_file
      file: scriptblocktext_packerindicators.py
      alias: true
      alias_name: "ScriptBlockText_PackerIndicators"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # User & Authentication Transforms
  # -------------------------
  User:
    - info: "Extract username without domain"
      type: python_file
      file: user_name.py
      alias: true
      alias_name: "User_Name"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Extract domain from User field"
      type: python_file
      file: user_domain.py
      alias: true
      alias_name: "User_Domain"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # DNS / QueryName Transforms
  # -------------------------
  QueryName:
    - info: "Extract TLD from DNS query"
      type: python_file
      file: queryname_tld.py
      alias: true
      alias_name: "QueryName_TLD"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Calculate DNS query entropy (detect DGA)"
      type: python_file
      file: queryname_entropyscore.py
      alias: true
      alias_name: "QueryName_EntropyScore"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Detect typosquatted official domains"
      type: python_file
      file: queryname_typosquatdetect.py
      alias: true
      alias_name: "QueryName_TyposquatDetect"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Analyze DNS subdomain structure"
      type: python_file
      file: queryname_subdomainanalysis.py
      alias: true
      alias_name: "QueryName_SubdomainAnalysis"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Hash Transforms
  # -------------------------
  Hashes:
    - info: "Extract MD5 hash from Hashes field"
      type: python_file
      file: hash_md5.py
      alias: true
      alias_name: "Hash_MD5"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

    - info: "Extract SHA256 hash from Hashes field"
      type: python_file
      file: hash_sha256.py
      alias: true
      alias_name: "Hash_SHA256"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Logon Type Transforms
  # -------------------------
  LogonType:
    - info: "Map Windows logon type IDs to descriptions"
      type: python_file
      file: logontype_description.py
      alias: true
      alias_name: "LogonType_Description"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Registry Transforms
  # -------------------------
  TargetObject:
    - info: "Identify suspicious registry paths"
      type: python_file
      file: targetobject_suspiciousregistry.py
      alias: true
      alias_name: "TargetObject_SuspiciousRegistry"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

  # -------------------------
  # Port Transforms
  # -------------------------
  DestinationPort:
    - info: "Categorize destination ports"
      type: python_file
      file: destinationport_category.py
      alias: true
      alias_name: "DestinationPort_Category"
      source_condition:
        - evtx_input
        - json_array_input
        - json_input
        - evtxtract_input
        - db_input

